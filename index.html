<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SYNTHETIX AI | Zenith Engine</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<script>
tailwind.config = {
    theme: {
        extend: {
            colors: {
                brand: {
                    dark: '#050505',
                    primary: '#7c3aed',
                    hover: '#6d28d9',
                    accent: '#d8b4fe',
                    surface: '#0a0a0a',
                    border: 'rgba(255,255,255,0.08)'
                }
            },
            fontFamily: {
                sans: ['Inter', 'sans-serif'],
                display: ['Space Grotesk', 'sans-serif'],
            }
        }
    }
}
</script>

<style>
body { background:#050505; color:#fff; overflow-x:hidden }
.chat-bubble-user{background:#7c3aed;color:white;border-radius:12px 12px 2px 12px;font-size:13px}
.chat-bubble-ai{background:rgba(255,255,255,0.05);border-radius:12px 12px 12px 2px;font-size:13px;color:#d1d5db}
.fade-in-up{animation:fadeInUp .4s ease-out}
@keyframes fadeInUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>

<body class="flex flex-col h-screen">

<div class="flex h-full">

<!-- CHAT -->
<aside class="w-[400px] bg-[#0a0a0a] border-r border-white/10 flex flex-col">
    <div class="p-4 border-b border-white/10 text-xs text-gray-400 uppercase tracking-widest">
        SYNTHETIX ENGINE
    </div>

    <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4">
        <div class="flex gap-3 fade-in-up">
            <div class="w-6 h-6 bg-brand-primary/20 flex items-center justify-center text-[10px] text-brand-primary font-bold">AI</div>
            <div class="chat-bubble-ai p-3 max-w-[90%]">
                Engine online. Qual arquitetura deseja criar?
            </div>
        </div>
    </div>

    <div class="p-4 border-t border-white/10">
        <div class="relative">
            <textarea id="userPrompt" class="w-full h-16 bg-[#151515] border border-white/10 rounded-xl p-3 text-sm resize-none outline-none focus:border-brand-primary" placeholder="Digite sua instru√ß√£o..."></textarea>
            <button onclick="generateSite()" class="absolute right-2 bottom-2 bg-brand-primary hover:bg-brand-hover w-10 h-10 rounded-lg text-white">
                <i class="fas fa-arrow-up"></i>
            </button>
        </div>
    </div>
</aside>

<!-- PREVIEW -->
<div class="flex-1 bg-black relative">
    <div id="loadingState" class="hidden absolute inset-0 bg-black/90 flex items-center justify-center z-50">
        <div class="text-brand-primary font-mono text-sm animate-pulse" id="loadingText">Processando...</div>
    </div>
    <iframe id="siteFrame" class="w-full h-full hidden bg-white"></iframe>
</div>

</div>

<script>
let currentCode = "";

async function generateSite() {

    const input = document.getElementById('userPrompt');
    const history = document.getElementById('chat-history');
    const prompt = input.value.trim();
    if(!prompt) return;

    const userMsg = document.createElement('div');
    userMsg.className = "flex justify-end fade-in-up";
    userMsg.innerHTML = `<div class="chat-bubble-user p-3 max-w-[90%]">${prompt}</div>`;
    history.appendChild(userMsg);
    input.value="";
    history.scrollTop = history.scrollHeight;

    const loading = document.getElementById('loadingState');
    const loadingText = document.getElementById('loadingText');

    loading.classList.remove('hidden');
    loadingText.innerText = currentCode 
        ? "‚ôªÔ∏è Atualizando estrutura existente..."
        : "üß† Criando nova arquitetura...";

    try {

        const response = await fetch('/api/generate', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                prompt,
                existingCode: currentCode || null
            })
        });

        const data = await response.json();

        if(data.html && data.html.includes("<html")){

            currentCode = data.html;

            const frame = document.getElementById('siteFrame');
            frame.classList.remove('hidden');
            frame.contentWindow.document.open();
            frame.contentWindow.document.write(currentCode);
            frame.contentWindow.document.close();

            const aiMsg = document.createElement('div');
            aiMsg.className="flex gap-3 fade-in-up";
            aiMsg.innerHTML=`
                <div class="w-6 h-6 bg-brand-primary/20 flex items-center justify-center text-[10px] text-brand-primary font-bold">AI</div>
                <div class="chat-bubble-ai p-3 max-w-[90%]">
                    ${currentCode ? "Estrutura atualizada mantendo base original." : "Interface criada com sucesso."}
                </div>
            `;
            history.appendChild(aiMsg);
            history.scrollTop = history.scrollHeight;
        }

    }catch(e){
        alert("Erro na gera√ß√£o.");
    }finally{
        loading.classList.add('hidden');
    }
}
</script>

</body>
</html>
